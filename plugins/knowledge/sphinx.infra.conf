source {IndexKey}_KnowledgeArticle {
    type = mysql
    sql_host = {Server}
    sql_user = {SphinxUser}
    sql_pass = {SphinxPassword}
    sql_db = {Database}
    sql_query_range = SELECT MIN(articleRevisionID),(select MaxID from GDN_SphinxCounter where CounterID = 5) FROM GDN_articleRevision
    sql_range_step = 10000
    sql_query_pre = set names utf8
    sql_query_pre = replace into GDN_SphinxCounter select 5, max(articleRevisionID) from GDN_articleRevision
    sql_query = SELECT \
            ar.articleRevisionID, \
            a.articleID, \
            a.knowledgeCategoryID, \
            a.insertUserID, \
            a.updateUserID, \
            unix_timestamp(a.dateInserted) as dateInserted, \
            unix_timestamp(a.dateUpdated) as dateUpdated, \
            ar.name, \
            ar.bodyRendered, \
            FIND_IN_SET(a.status, 'published,deleted,undeleted') as status \
        FROM GDN_articleRevision ar \
        INNER JOIN GDN_article a \
        ON a.articleID = ar.articleID \
        WHERE ar.status = "published" \
            AND ar.articleRevisionID >= $start \
            AND ar.articleRevisionID <= $end
    sql_attr_bigint = articleID
    sql_attr_uint = knowledgeCategoryID
    sql_attr_uint = insertUserID
    sql_attr_uint = updateUserID
    sql_attr_timestamp = dateUpdated
    sql_attr_uint = status
    sql_attr_timestamp = dateInserted
}

source {IndexKey}_KnowledgeArticle_Delta: {IndexKey}_KnowledgeArticle {
    sql_query_range = SELECT (select MaxID from GDN_SphinxCounter where CounterID = 5), MAX(articleRevisionID) FROM GDN_articleRevision
    sql_query_pre = set names utf8
    sql_query = SELECT \
                ar.articleRevisionID, \
                a.articleID, \
                a.knowledgeCategoryID, \
                a.insertUserID, \
                a.updateUserID, \
                unix_timestamp(a.DateInserted) as DateInserted, \
                unix_timestamp(a.dateUpdated) as dateUpdated, \
                ar.name, \
                ar.bodyRendered, \
                FIND_IN_SET(a.status, 'published,deleted,undeleted') as status \
            FROM GDN_articleRevision ar \
            INNER JOIN GDN_article a \
            ON a.articleID = ar.articleID \
            WHERE ar.status = "published" \
                 AND ar.articleRevisionID >= $start \
                 AND ar.articleRevisionID <= $end
}

index {IndexKey}_KnowledgeArticle {
    source = {IndexKey}_KnowledgeArticle
    path = /var/data/searchd/{Name}/{IndexKey}_KnowledgeArticle
    morphology = stem_en
    stopwords = /var/data/searchd/stops.txt
    html_strip = 1
    min_infix_len = 3
    infix_fields = name
    expand_keywords = 1
}

index {IndexKey}_KnowledgeArticle_Delta: {IndexKey}_KnowledgeArticle {
    source = {IndexKey}_KnowledgeArticle_Delta
    path = /var/data/searchd/{Name}/{IndexKey}_KnowledgeArticle_Delta
}
