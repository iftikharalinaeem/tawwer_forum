function AnalyticsDashboard(a,b,c,d){var e=null,f="",g={},h=!1,i={end:new Date,start:new Date},j="";this.addPanel=function(a,b){if("object"==typeof b){var c;if("undefined"!=typeof b.widgets&&Array.isArray(b.widgets)){c=[];for(var d=0;d<b.widgets.length;d++)b.widgets[d].timeframe=this.getTimeframe(),c.push(new AnalyticsWidget(b.widgets[d]));delete b.widgets}else c=[];return b.widgets=c,g[a]=b}return!1},this.getCategoryID=function(){return e},this.getDashboardID=function(){return f},this.getPanel=function(a){return"undefined"==typeof a?g:g[a]||!1},this.getTimeframe=function(){return i},this.getTitle=function(){return j},this.isPersonal=function(){return h},this.resetPanels=function(a){if(a===!0)for(var b in this.getPanel())this.emptyPanelContainer(b);return g={}},this.setCategoryID=function(a){return"undefined"==typeof a?!1:void(this.categoryID=null===a?null:parseInt(a))},this.setDashboardID=function(a){return"string"!=typeof a&&"number"!=typeof a?!1:f=a},this.setTimeframe=function(a,b){if("object"!=typeof a||!(a instanceof Date))throw"Invalid start date";if("object"!=typeof b||!(b instanceof Date))throw"Invalid end date";if(a>=b)throw"Invalid date range. Start equals or surpasses end.";return i.start=a,i.end=b,i},this.setPersonal=function(a){return"boolean"!=typeof a?!1:h=a},this.setTitle=function(a){return"string"!=typeof a?!1:j=a},i.start.setHours(0,0,0),i.start.setMonth(i.end.getMonth()-1),b instanceof Date&&c instanceof Date&&this.setTimeframe(b,c),"undefined"!=typeof d&&this.setCategoryID(d),this.loadConfig(a)}function AnalyticsWidget(a){var b=!1,c=[],d=null,e=null,f=[],g="",h="chart",i=null,j={end:new Date,start:new Date};this.addSupport=function(a){if("undefined"!==a)if(Array.isArray(a))for(var b=0;b<a.length;b++)this.addSupport(a[b]);else"string"==typeof a&&f.push(a)},this.createElements=function(a){if(a="undefined"==typeof a?!0:!!a){var b=this.getElements();null!==b&&b.container.parentNode.removeChild(oldElements.container)}var c={body:document.createElement("div"),header:document.createElement("div"),bookmark:document.createElement("a"),options:document.createElement("div"),container:document.createElement("li"),title:null};c.container.setAttribute("id","analytics_widget_"+i),c.container.setAttribute("class","analytics-widget analytics-widget-"+h),c.options.setAttribute("class","analytics-widget-options"),c.header.setAttribute("class","analytics-widget-header"),this.isBookmarked()?c.bookmark.setAttribute("class","Hijack bookmark bookmarked"):c.bookmark.setAttribute("class","Hijack bookmark"),c.bookmark.setAttribute("href",gdn.url("/settings/analytics/bookmarkwidget/"+this.getWidgetID())),c.bookmark.innerHTML="Bookmark","metric"!==this.getType()&&(c.title=document.createElement("h4"),c.title.setAttribute("class","title"),c.title.innerHTML=this.getTitle(),c.options.appendChild(c.bookmark),c.header.appendChild(c.title),c.header.appendChild(c.options),c.container.appendChild(c.header)),c.body.setAttribute("class","body"),c.container.appendChild(c.body),d=c},this.getData=function(){return c},this.getElements=function(a){if(null===d&&this.createElements(!1),"string"==typeof a){if("undefined"!=typeof d[a])return d[a];throw"Invalid widget child element specified"}return d},this.getHandler=function(){return e},this.getInterval=function(){return c.query.interval},this.getTitle=function(){return g},this.getTimeframe=function(){return j},this.getType=function(){return h},this.getWidgetID=function(){return i},this.isBookmarked=function(){return b},this.setBookmarked=function(a){"boolean"==typeof a&&(b=a)},this.setData=function(a){"object"==typeof a&&(c=a)},this.setFilter=function(a,b,d){if(d&&!this.supports(d))return!1;var e=c.query.filters=c.query.filters||[],f=void 0;for(var g in e)if(e[g].property_name===a){b||e.splice(g,1),f=e[g];break}return b?(void 0===f?e.push({operator:"eq",property_name:a,property_value:b}):f.property_value=b,void this.drillGroupBy(d)):(this.drillGroupBy(d,!0),!0)},this.drillGroupBy=function(a,b){if(void 0!==c.query&&c.query.groupBy){var d,e;b?(d=a.replace("01","02"),e=a):(d=a,e=a.replace("01","02"));var f=this.getHandler().getQueryParam("groupBy");this.getHandler().updateQueryParams({groupBy:f.replace(d,e)})}},this.setCallback=function(a){if(null!==e)return e.setCallback(a),this;throw"No handler present for callback"},this.setHandler=function(a){if("string"==typeof a&&"function"==typeof window[a]){var b=this.getData();e=new window[a]({chartConfig:b.chartConfig,query:b.query,range:this.getTimeframe(),title:this.getTitle(),type:this.getType(),height:"30"})}else{if("object"!=typeof a)throw"Invalid value for newHandler";e=a}},this.setInterval=function(a){return this.getHandler().setInterval(a),!0},this.setRange=function(a){return this.getHandler().setRange(a),!0},this.setTitle=function(a){"string"==typeof a&&(g=a)},this.setType=function(a){"string"==typeof a&&(h=a)},this.setWidgetID=function(a){"string"==typeof a&&(i=a)},this.setTimeframe=function(a,b){if("object"!=typeof a||!(a instanceof Date))throw"Invalid start date";if("object"!=typeof b||!(b instanceof Date))throw"Invalid end date";if(a>=b)throw"Invalid date range. Start equals or surpasses end.";return j.start=a,j.end=b,j},this.supports=function(a){return-1!==f.indexOf(a)},this.loadConfig(a)}function AnalyticsWidget(a){var b=!1,c=[],d=null,e=null,f=[],g="",h="chart",i=null,j={end:new Date,start:new Date};this.addSupport=function(a){if("undefined"!==a)if(Array.isArray(a))for(var b=0;b<a.length;b++)this.addSupport(a[b]);else"string"==typeof a&&f.push(a)},this.createElements=function(a){if(a="undefined"==typeof a?!0:!!a){var b=this.getElements();null!==b&&b.container.parentNode.removeChild(oldElements.container)}var c={body:document.createElement("div"),bookmark:document.createElement("a"),container:document.createElement("li"),title:null};c.container.setAttribute("id","analytics_widget_"+i),c.container.setAttribute("class","analytics-widget analytics-widget-"+h),this.isBookmarked()?c.bookmark.setAttribute("class","Hijack Bookmark Bookmarked"):c.bookmark.setAttribute("class","Hijack Bookmark"),c.bookmark.setAttribute("href",gdn.url("/settings/analytics/bookmarkwidget/"+this.getWidgetID())),c.bookmark.innerHTML="Bookmark","metric"!==this.getType()&&(c.title=document.createElement("h4"),c.title.setAttribute("class","title"),c.title.innerHTML=this.getTitle(),c.title.appendChild(c.bookmark),c.container.appendChild(c.title)),c.body.setAttribute("class","body"),c.container.appendChild(c.body),d=c},this.getData=function(){return c},this.getElements=function(a){if(null===d&&this.createElements(!1),"string"==typeof a){if("undefined"!=typeof d[a])return d[a];throw"Invalid widget child element specified"}return d},this.getHandler=function(){return e},this.getInterval=function(){return c.query.interval},this.getTitle=function(){return g},this.getTimeframe=function(){return j},this.getType=function(){return h},this.getWidgetID=function(){return i},this.isBookmarked=function(){return b},this.setBookmarked=function(a){"boolean"==typeof a&&(b=a)},this.setData=function(a){"object"==typeof a&&(c=a)},this.setFilter=function(a,b,d){if(d&&!this.supports(d))return!1;var e=c.query.filters=c.query.filters||[],f=void 0;for(var g in e)if(e[g].property_name===a){b||e.splice(g,1),f=e[g];break}return b?(void 0===f?e.push({operator:"eq",property_name:a,property_value:b}):f.property_value=b,void this.drillGroupBy(d)):(this.drillGroupBy(d,!0),!0)},this.drillGroupBy=function(a,b){if(void 0!==c.query&&c.query.groupBy){var d,e;b?(d=a.replace("01","02"),e=a):(d=a,e=a.replace("01","02"));var f=this.getHandler().getQueryParam("groupBy");this.getHandler().updateQueryParams({groupBy:f.replace(d,e)})}},this.setCallback=function(a){if(null!==e)return e.setCallback(a),this;throw"No handler present for callback"},this.setHandler=function(a){if("string"==typeof a&&"function"==typeof window[a]){var b=this.getData();e=new window[a]({chartConfig:b.chartConfig,query:b.query,range:this.getTimeframe(),title:this.getTitle(),type:this.getType()})}else{if("object"!=typeof a)throw"Invalid value for newHandler";e=a}},this.setInterval=function(a){return this.getHandler().setInterval(a),!0},this.setRange=function(a){return this.getHandler().setRange(a),!0},this.setTitle=function(a){"string"==typeof a&&(g=a)},this.setType=function(a){"string"==typeof a&&(h=a)},this.setWidgetID=function(a){"string"==typeof a&&(i=a)},this.setTimeframe=function(a,b){if("object"!=typeof a||!(a instanceof Date))throw"Invalid start date";if("object"!=typeof b||!(b instanceof Date))throw"Invalid end date";if(a>=b)throw"Invalid date range. Start equals or surpasses end.";return j.start=a,j.end=b,j},this.supports=function(a){return-1!==f.indexOf(a)},this.loadConfig(a)}function removeAnalyticsWidget(){if("object"==typeof window.analyticsDashboard&&window.analyticsDashboard instanceof AnalyticsDashboard){var a=window.analyticsDashboard;if(a.isPersonal()!==!1&&$(this).size()>0){var b=$(this).get(0);if(b instanceof HTMLElement){var c=b.id,d=/analytics_widget_([a-z0-9\-]+)/i.exec(c);if(Array.isArray(d)){var e=d[1];a.removeWidget(e)}}}}}function removeAnalyticsWidget(){if("object"==typeof window.analyticsDashboard&&window.analyticsDashboard instanceof AnalyticsDashboard){var a=window.analyticsDashboard;if(a.isPersonal()!==!1&&$(this).size()>0){var b=$(this).get(0);if(b instanceof HTMLElement){var c=b.id,d=/analytics_widget_([a-z0-9\-]+)/i.exec(c);if(Array.isArray(d)){var e=d[1];a.removeWidget(e)}}}}}function KeenIOWidget(a){var b=null,c={},d=null,e=[],f=null,g="daily",h=null,i=[],j={end:null,start:null},k=null,l="";this.addQuery=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.addQuery(a[b]);else if("object"==typeof a){var c={eventCollection:a.eventCollection||null,maxAge:86400};"undefined"!=typeof a.filters&&Array.isArray(a.filters)&&a.filters.length>0&&(c.filters=a.filters),"undefined"!=typeof a.groupBy&&null!==a.groupBy&&(c.groupBy=a.groupBy),"undefined"!=typeof a.target_property&&(c.target_property=a.target_property);var d=new Keen.Query(a.analisysType||null,c);d.title=a.title||null,i.push(d)}},this.getCallback=function(){return b},this.getClient=function(){if(null===d&&"function"==typeof Keen){var a=gdn.meta["keenio.projectID"]||!1,b=gdn.meta["keenio.readKey"]||!1;d=new Keen({projectId:a,readKey:b})}return d},this.getConfig=function(a,b){return"undefined"==typeof c[a]?b||null:c[a]},this.getData=function(){return e},this.getDataviz=function(){return null===f&&(f=new Keen.Dataviz,this.loadDatavizConfig(this.getConfig())),f},this.getElement=function(){return h},this.getInterval=function(){return g},this.getRange=function(){return j},this.getQuery=function(){return i},this.getQueryParam=function(a,b){var c=this.getQuery();if(b="undefined"==typeof b?0:parseInt(b),"undefined"==typeof c[b])throw"Invalid query index";var d=c[b];return d.get(a)},this.getTitle=function(){return l},this.getType=function(){return k},this.resetQuery=function(){i=[]},this.setCallback=function(a){if("function"==typeof this[a])return b=this[a],this;throw"Invalid value for newCallback"},this.setData=function(a){if("undefined"!=typeof a)return e=a,this;throw"Invalid newData"},this.setElement=function(a){if(a instanceof HTMLElement)return h=a,this;throw"newElement is not an instance of HTMLElement"},this.setInterval=function(a){if("string"==typeof a)return g=a,this;throw"newInterval must be a string"},this.setRange=function(a){if("object"!=typeof a)throw"Invalid newRange";var b=a.end||!1,c=a.start||!1;return"object"==typeof b&&b instanceof Date?j.end=b:(j.end=new Date,j.end.setHours(0,0,0)),"object"==typeof c&&c instanceof Date?j.start=c:(j.start=new Date,j.start.setHours(0,0,0),j.start.setMonth(j.end.getMonth()-1)),this},this.setType=function(a){if("string"==typeof a)return k=a,this;throw"Invalid newType"},this.setTitle=function(a){if("string"==typeof a)return l=a,this;throw"Invalid newTitle"},this.updateQueryParams=function(a){if("object"!=typeof a)throw"Invalid newParams";for(var b=0;b<i.length;b++)i[b].set(a)},this.loadConfig(a)}function KeenIOWidget(a){var b=null,c={},d=null,e=[],f=null,g="daily",h=null,i=[],j={end:null,start:null},k=null,l="";this.addQuery=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.addQuery(a[b]);else if("object"==typeof a){var c={eventCollection:a.eventCollection||null,maxAge:86400};"undefined"!=typeof a.filters&&Array.isArray(a.filters)&&a.filters.length>0&&(c.filters=a.filters),"undefined"!=typeof a.groupBy&&null!==a.groupBy&&(c.groupBy=a.groupBy),"undefined"!=typeof a.target_property&&(c.target_property=a.target_property);var d=new Keen.Query(a.analisysType||null,c);d.title=a.title||null,i.push(d)}},this.getCallback=function(){return b},this.getClient=function(){if(null===d&&"function"==typeof Keen){var a=gdn.meta["keenio.projectID"]||!1,b=gdn.meta["keenio.readKey"]||!1;d=new Keen({projectId:a,readKey:b})}return d},this.getConfig=function(a,b){return"undefined"==typeof c[a]?b||null:c[a]},this.getData=function(){return e},this.getDataviz=function(){return null===f&&(f=new Keen.Dataviz,this.loadDatavizConfig(this.getConfig())),f},this.getElement=function(){return h},this.getInterval=function(){return g},this.getRange=function(){return j},this.getQuery=function(){return i},this.getQueryParam=function(a,b){var c=this.getQuery();if(b="undefined"==typeof b?0:parseInt(b),"undefined"==typeof c[b])throw"Invalid query index";var d=c[b];return d.get(a)},this.getTitle=function(){return l},this.getType=function(){return k},this.resetQuery=function(){i=[]},this.setCallback=function(a){if("function"==typeof this[a])return b=this[a],this;throw"Invalid value for newCallback"},this.setData=function(a){if("undefined"!=typeof a)return e=a,this;throw"Invalid newData"},this.setElement=function(a){if(a instanceof HTMLElement)return h=a,this;throw"newElement is not an instance of HTMLElement"},this.setInterval=function(a){if("string"==typeof a)return g=a,this;throw"newInterval must be a string"},this.setRange=function(a){if("object"!=typeof a)throw"Invalid newRange";var b=a.end||!1,c=a.start||!1;return"object"==typeof b&&b instanceof Date?j.end=b:(j.end=new Date,j.end.setHours(0,0,0)),"object"==typeof c&&c instanceof Date?j.start=c:(j.start=new Date,j.start.setHours(0,0,0),j.start.setMonth(j.end.getMonth()-1)),this},this.setType=function(a){if("string"==typeof a)return k=a,this;throw"Invalid newType"},this.setTitle=function(a){if("string"==typeof a)return l=a,this;throw"Invalid newTitle"},this.updateQueryParams=function(a){if("object"!=typeof a)throw"Invalid newParams";for(var b=0;b<i.length;b++)i[b].set(a)},this.loadConfig(a)}AnalyticsDashboard.prototype.emptyPanelContainer=function(a){var b="analytics_panel_"+a,c=document.getElementById(b);if("object"!=typeof c)return!1;if(c.hasChildNodes())for(i=0;i<c.childNodes.length;i++)c.removeChild(c.childNodes[i]);return!0},AnalyticsDashboard.prototype.loadConfig=function(a){if("object"!=typeof a)throw"Invalid dashboard config";if("undefined"!=typeof a.dashboardID&&this.setDashboardID(a.dashboardID),"object"==typeof a.panels){var b,c=Object.getOwnPropertyNames(a.panels);this.resetPanels();for(var d=0;d<c.length;d++)b=c[d],this.addPanel(b,a.panels[b])}"undefined"!=typeof a.personal&&this.setPersonal(a.personal),"string"==typeof a.title&&this.setTitle(a.title)},AnalyticsDashboard.prototype.removeWidget=function(a){var b=this.getPanel();for(var c in this.getPanel()){var d="analytics_panel_"+c,e=document.getElementById(d);if("object"!=typeof e)return;var f=b[c].widgets;if(0!==f.length)for(var g=0;g<f.length;g++)if(f[g].getWidgetID()===a){var h=f[g].getElements("container");h instanceof HTMLElement&&e.removeChild(h),f.splice(g,1)}}},AnalyticsDashboard.prototype.setupSorting=function(){"undefined"!=typeof $.fn.sortable&&($(".analytics-panel-charts").sortable({handle:".title",update:this.sortUpdate.bind(this)}),$(".analytics-panel-charts").disableSelection())},AnalyticsDashboard.prototype.sortUpdate=function(a,b){for(var c,d=$(a.target).sortable("toArray"),e={},f=0;f<d.length;f++)c=AnalyticsWidget.getIDFromAttribute(d[f]),c&&(e[c]=f+1);$.post(gdn.url("/settings/analytics/dashboardsort/"+this.getDashboardID()),{TransientKey:gdn.definition("TransientKey"),Widgets:e})},AnalyticsDashboard.prototype.writeDashboard=function(){for(var a in this.getPanel())this.emptyPanelContainer(a),this.writePanel(a);this.isPersonal()&&this.setupSorting()},AnalyticsDashboard.prototype.writePanel=function(a){var b=this.getPanel(a);if(b===!1)throw"Invalid panel: "+a;var c="analytics_panel_"+a,d=document.getElementById(c);if("object"!=typeof d)throw"Unable to find container: #"+c;if("undefined"==typeof b.widgets||!Array.isArray(b.widgets))throw"Panel does not contain a widget array.";for(var e=0;e<b.widgets.length;e++)b.widgets[e].render(),d.appendChild(b.widgets[e].getElements("container"))},$(document).ready(function(){function a(a,b){var c=[window.analyticsDashboard.getPanel("metrics"),window.analyticsDashboard.getPanel("charts")];for(var d in c){panel=c[d];for(var e in panel.widgets)widget=panel.widgets[e],"function"==typeof widget[a]&&(valid=widget[a].apply(widget,b),valid!==!1&&widget.render())}}$(document).on("change","#Form_cat01",function(){var b=$(this).val();a("setFilter",["categoryAncestors.cat01.categoryID",b,"cat01"])}),$(document).on("change","#Form_intervals",function(){var b=$(this).val();a("setInterval",[b])}),$(".js-date-range").daterangepicker({datepickerOptions:{numberOfMonths:2},presetRanges:[{text:"Past 30 Days",dateStart:function(){return moment().subtract("days",30)},dateEnd:function(){return moment()}},{text:"This Month",dateStart:function(){return moment().startOf("month")},dateEnd:function(){return moment().endOf("month")}},{text:"Last Month",dateStart:function(){return moment().subtract("month",1).startOf("month")},dateEnd:function(){return moment().subtract("month",1).endOf("month")}},{text:"Past Year",dateStart:function(){return moment().subtract("year",1)},dateEnd:function(){return moment()}},{text:"Year to Date",dateStart:function(){return moment().startOf("year")},dateEnd:function(){return moment()}}],onChange:function(){var b=$(".js-date-range").daterangepicker("getRange");a("setRange",[b])}})}),$(document).ready(function(){function a(a,b){var c=[window.analyticsDashboard.getPanel("metrics"),window.analyticsDashboard.getPanel("charts")];for(var d in c){panel=c[d];for(var e in panel.widgets)widget=panel.widgets[e],"function"==typeof widget[a]&&(valid=widget[a].apply(widget,b),valid!==!1&&widget.render())}}$(document).on("change","#Form_cat01",function(){var b=$(this).val();a("setFilter",["categoryAncestors.cat01.categoryID",b,"cat01"])}),$(document).on("change","#Form_intervals",function(){var b=$(this).val();a("setInterval",[b])})}),AnalyticsWidget.getIDFromAttribute=function(a){var b=/analytics_widget_([a-z0-9\-]+)/i.exec(a);return Array.isArray(b)?b[1]:!1},AnalyticsWidget.prototype.loadConfig=function(a){if("object"!=typeof a)throw"Invalid dashboard config";"undefined"!=typeof a.bookmarked&&this.setBookmarked(a.bookmarked),"undefined"!=typeof a.data&&this.setData(a.data),"undefined"!=typeof a.supports&&this.addSupport(a.supports),"undefined"!=typeof a.title&&this.setTitle(a.title),"undefined"!=typeof a.type&&this.setType(a.type),"undefined"!=typeof a.widgetID&&this.setWidgetID(a.widgetID),"undefined"!=typeof a.timeframe&&"object"==typeof a.timeframe.start&&"object"==typeof a.timeframe.end&&this.setTimeframe(a.timeframe.start,a.timeframe.end),"undefined"!=typeof a.handler&&(this.setHandler(a.handler),"undefined"!=typeof a.callback&&a.callback&&this.setCallback(a.callback))},AnalyticsWidget.prototype.render=function(){var a=this.getHandler();if(null===a)throw"No data handler configured for widget";a.writeContents(this.getElements("body"))},AnalyticsWidget.getIDFromAttribute=function(a){var b=/analytics_widget_([a-z0-9\-]+)/i.exec(a);return Array.isArray(b)?b[1]:!1},AnalyticsWidget.prototype.loadConfig=function(a){if("object"!=typeof a)throw"Invalid dashboard config";"undefined"!=typeof a.bookmarked&&this.setBookmarked(a.bookmarked),"undefined"!=typeof a.data&&this.setData(a.data),"undefined"!=typeof a.supports&&this.addSupport(a.supports),"undefined"!=typeof a.title&&this.setTitle(a.title),"undefined"!=typeof a.type&&this.setType(a.type),"undefined"!=typeof a.widgetID&&this.setWidgetID(a.widgetID),"undefined"!=typeof a.timeframe&&"object"==typeof a.timeframe.start&&"object"==typeof a.timeframe.end&&this.setTimeframe(a.timeframe.start,a.timeframe.end),"undefined"!=typeof a.handler&&(this.setHandler(a.handler),"undefined"!=typeof a.callback&&a.callback&&this.setCallback(a.callback))},AnalyticsWidget.prototype.render=function(){var a=this.getHandler();if(null===a)throw"No data handler configured for widget";a.writeContents(this.getElements("body"))},$(document).ready(function(){var a=gdn.meta.analyticsDashboard||!1;if("object"==typeof a){var b=new AnalyticsDashboard(a);b.writeDashboard(),window.analyticsDashboard=b}}),$(document).ready(function(){var a=gdn.meta.analyticsDashboard||!1;if("object"==typeof a){var b=new AnalyticsDashboard(a);b.writeDashboard(),window.analyticsDashboard=b}});var keenTracker={keenClient:!1,projectID:gdn.meta["keenio.projectID"]||!1,writeKey:gdn.meta["keenio.writeKey"]||!1};keenTracker.analyticsTickHandler=function(a,b,c,d){"success"===d&&keenTracker.event("page_view")},keenTracker.event=function(a,b){var c=this.getKeenClient(),d=gdn.definition("eventData",{});c&&Object.keys(d).length>0&&(d.type=a,d.user=this.getUser(d),c.addEvent(b||"page",d,function(a,b){}))},keenTracker.getKeenClient=function(){return!this.keenClient&&this.projectID&&this.writeKey&&"function"==typeof Keen&&(this.keenClient=new Keen({projectId:this.projectID,writeKey:this.writeKey})),this.keenClient},keenTracker.getUser=function(a){var b={};if("object"==typeof a&&"object"==typeof a.user&&(b=a.user,("undefined"==typeof b.uuid||"undefined"==typeof b.sessionID)&&"function"==typeof Cookies)){var c=Cookies.getJSON(gdn.definition("vaCookieName"));"undefined"==typeof b.uuid&&"undefined"!=typeof c.uuid&&(b.uuid=c.uuid),"undefined"==typeof b.sessionID&&"undefined"!=typeof c.sessionID&&(b.sessionID=c.sessionID)}return b},$(document).on("analyticsTick",keenTracker.analyticsTickHandler);var keenTracker={keenClient:!1,projectID:gdn.meta["keenio.projectID"]||!1,writeKey:gdn.meta["keenio.writeKey"]||!1};keenTracker.analyticsTickHandler=function(a,b,c,d){"success"===d&&keenTracker.event("page_view")},keenTracker.event=function(a,b){var c=this.getKeenClient(),d=gdn.definition("eventData",{});c&&Object.keys(d).length>0&&(d.type=a,d.user=this.getUser(d),c.addEvent(b||"page",d,function(a,b){}))},keenTracker.getKeenClient=function(){return!this.keenClient&&this.projectID&&this.writeKey&&"function"==typeof Keen&&(this.keenClient=new Keen({projectId:this.projectID,writeKey:this.writeKey})),this.keenClient},keenTracker.getUser=function(a){var b={};if("object"==typeof a&&"object"==typeof a.user&&(b=a.user,("undefined"==typeof b.uuid||"undefined"==typeof b.sessionID)&&"function"==typeof Cookies)){var c=Cookies.getJSON(gdn.definition("vaCookieName"));"undefined"==typeof b.uuid&&"undefined"!=typeof c.uuid&&(b.uuid=c.uuid),"undefined"==typeof b.sessionID&&"undefined"!=typeof c.sessionID&&(b.sessionID=c.sessionID)}return b},$(document).on("analyticsTick",keenTracker.analyticsTickHandler),KeenIOWidget.prototype.divideResult=function(a){var b=[];if(!Array.isArray(a))throw"divideResult requires an array";if(2!==a[0].value.length)throw"divideResult requires exactly two results";for(var c=0;c<a.length;c++){var d;d=a[c].value[1].result>0?parseFloat((a[c].value[0].result/a[c].value[1].result).toFixed(2)):0,b.push({timeframe:a[c].timeframe,value:d})}return b},KeenIOWidget.prototype.getMetricMarkup=function(){var a='<span class="metric-value">{data}</span><span class="metric-title">{title}</span>',b=this.getData();this.getTitle();return a=a.replace("{data}",Number(b).toLocaleString()),a=a.replace("{title}",this.getTitle())},KeenIOWidget.prototype.loadConfig=function(a){if("object"!=typeof a)throw"Invalid config";"undefined"!=typeof a.chartConfig&&this.setChartConfig(a.chartConfig),"undefined"!=typeof a.query&&(this.resetQuery(),this.addQuery(a.query)),"undefined"!=typeof a.range&&this.setRange(a.range),"undefined"!=typeof a.title&&this.setTitle(a.title),"undefined"!=typeof a.type&&this.setType(a.type)},KeenIOWidget.prototype.loadDatavizConfig=function(a){var b=this.getDataviz();b.library("c3"),b.chartType(this.getConfig("type","area")),b.chartOptions(this.getConfig("options",{}))},KeenIOWidget.prototype.renderBody=function(){var a=this.getDataviz(),b=a.el();if(!("object"==typeof b&&b instanceof HTMLElement))throw"No valid dataviz element";switch($(b).parent().removeClass("data-loading"),this.getType()){case"metric":b.innerHTML=this.getMetricMarkup();break;default:a.parseRawData({result:this.getData()});var c=a.labels();if(c.length>1)a.stacked(!0);else{var d=$(b).parent(".analytics-widget").index(),e=a.colors();a.colors([e[d%e.length]])}for(var f=0;f<c.length;f++)""===c[f]&&(c[f]="(None)");a.labels(c),a.view._rendered?a.update():a.render()}},KeenIOWidget.prototype.runQuery=function(a){var b=this.getClient(),c=this,d={timeframe:this.getRange()};"metric"!==this.getType()&&(d.interval=this.getInterval()),this.updateQueryParams(d);var e=this.getQuery();b.run(e,function(b,d){if(null===b){var f=c.getQueryResult(d,e);if(c.setData(f),"function"==typeof a){var g=a.bind(c);g()}}})},KeenIOWidget.prototype.getQueryResult=function(a,b){var c=this.getCallback(),d=[];if("undefined"!=typeof a&&"undefined"!=typeof b)if(Array.isArray(a)&&a.length>0){var e=a.shift().result;if(a.length>=1)for(var f=0;f<e.length;f++){var g=[];g.push({category:b[0].title,result:e[f].value});for(var h=0;h<a.length;h++){var i=h+1;g.push({category:b[i].title,result:a[h].result[f].value})}d.push({timeframe:e[f].timeframe,value:g})}else d=e,d.category=b[0].title}else"object"==typeof a&&"undefined"!=typeof a.result&&(Array.isArray(a.result)?(d=a.result,d.category=b[0].title):d=a.result);return c&&(d=c(d)),d},KeenIOWidget.prototype.writeContents=function(a,b){var c=this.getClient(),d=this.getDataviz();if(b="undefined"==typeof b?!1:!!b,"object"==typeof c){var e=d.el();!b&&("object"==typeof e||e instanceof HTMLElement)||d.el(a),"metric"==this.getType()&&d.height(100),d.view._prepared===!1&&d.prepare(),$(a).parent().addClass("data-loading"),this.runQuery(this.renderBody)}},KeenIOWidget.prototype.divideResult=function(a){var b=[];if(!Array.isArray(a))throw"divideResult requires an array";if(2!==a[0].value.length)throw"divideResult requires exactly two results";for(var c=0;c<a.length;c++){var d;d=a[c].value[1].result>0?parseFloat((a[c].value[0].result/a[c].value[1].result).toFixed(2)):0,b.push({timeframe:a[c].timeframe,value:d})}return b},KeenIOWidget.prototype.getMetricMarkup=function(){var a='<span class="metric-value">{data}</span><span class="metric-title">{title}</span>',b=this.getData();return this.getTitle(),a=a.replace("{data}",Number(b).toLocaleString()),a=a.replace("{title}",this.getTitle())},KeenIOWidget.prototype.loadConfig=function(a){if("object"!=typeof a)throw"Invalid config";"undefined"!=typeof a.chartConfig&&this.setChartConfig(a.chartConfig),"undefined"!=typeof a.query&&(this.resetQuery(),this.addQuery(a.query)),"undefined"!=typeof a.range&&this.setRange(a.range),"undefined"!=typeof a.title&&this.setTitle(a.title),"undefined"!=typeof a.type&&this.setType(a.type)},KeenIOWidget.prototype.loadDatavizConfig=function(a){var b=this.getDataviz();b.library("c3"),b.chartType(this.getConfig("type","area")),b.chartOptions(this.getConfig("options",{}))},KeenIOWidget.prototype.renderBody=function(){var a=this.getDataviz(),b=a.el();if(!("object"==typeof b&&b instanceof HTMLElement))throw"No valid dataviz element";switch($(b).parent().removeClass("data-loading"),this.getType()){case"metric":b.innerHTML=this.getMetricMarkup();break;default:a.parseRawData({result:this.getData()});var c=a.labels();if(c.length>1)a.stacked(!0);else{var d=$(b).parent(".analytics-widget").index(),e=a.colors();a.colors([e[d%e.length]])}for(var f=0;f<c.length;f++)""===c[f]&&(c[f]="(None)");a.labels(c),a.view._rendered?a.update():a.render()}},KeenIOWidget.prototype.runQuery=function(a){var b=this.getClient(),c=this,d={timeframe:this.getRange()};"metric"!==this.getType()&&(d.interval=this.getInterval()),this.updateQueryParams(d);var e=this.getQuery();b.run(e,function(b,d){if(null===b){var f=c.getQueryResult(d,e);if(c.setData(f),"function"==typeof a){var g=a.bind(c);g()}}})},KeenIOWidget.prototype.getQueryResult=function(a,b){var c=this.getCallback(),d=[];if("undefined"!=typeof a&&"undefined"!=typeof b)if(Array.isArray(a)&&a.length>0){var e=a.shift().result;if(a.length>=1)for(var f=0;f<e.length;f++){var g=[];g.push({category:b[0].title,result:e[f].value});for(var h=0;h<a.length;h++){var i=h+1;g.push({category:b[i].title,result:a[h].result[f].value})}d.push({timeframe:e[f].timeframe,value:g})}else d=e,d.category=b[0].title}else"object"==typeof a&&"undefined"!=typeof a.result&&(Array.isArray(a.result)?(d=a.result,d.category=b[0].title):d=a.result);return c&&(d=c(d)),d},KeenIOWidget.prototype.writeContents=function(a,b){var c=this.getClient(),d=this.getDataviz();if(b="undefined"==typeof b?!1:!!b,"object"==typeof c){var e=d.el();(b||"object"!=typeof e&&!(e instanceof HTMLElement))&&d.el(a),d.view._prepared===!1&&d.prepare(),$(a).parent().addClass("data-loading"),this.runQuery(this.renderBody)}};
//# sourceMappingURL=src.map