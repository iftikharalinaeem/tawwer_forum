function AnalyticsDashboard(a,b,c,d){var e=null,f="",g={},h=!1,i={end:new Date,start:new Date},j="";this.addPanel=function(a,b){if("object"==typeof b){var c;if("undefined"!=typeof b.widgets&&Array.isArray(b.widgets)){c=[];for(var d=0;d<b.widgets.length;d++)b.widgets[d].timeframe=this.getTimeframe(),c.push(new AnalyticsWidget(b.widgets[d]));delete b.widgets}else c=[];return b.widgets=c,g[a]=b}return!1},this.getCategoryID=function(){return e},this.getDashboardID=function(){return f},this.getPanel=function(a){return"undefined"==typeof a?g:g[a]||!1},this.getTimeframe=function(){return i},this.getTitle=function(){return j},this.isPersonal=function(){return h},this.resetPanels=function(a){if(a===!0)for(var b in this.getPanel())this.emptyPanelContainer(b);return g={}},this.setCategoryID=function(a){return"undefined"==typeof a?!1:void(this.categoryID=null===a?null:parseInt(a))},this.setDashboardID=function(a){return"string"!=typeof a&&"number"!=typeof a?!1:f=a},this.setTimeframe=function(a,b){if("object"!=typeof a||!(a instanceof Date))throw"Invalid start date";if("object"!=typeof b||!(b instanceof Date))throw"Invalid end date";if(a>=b)throw"Invalid date range. Start equals or surpasses end.";return i.start=a,i.end=b,i},this.setPersonal=function(a){return"boolean"!=typeof a?!1:h=a},this.setTitle=function(a){return"string"!=typeof a?!1:j=a},i.start.setHours(0,0,0),i.start.setMonth(i.end.getMonth()-1),b instanceof Date&&c instanceof Date&&this.setTimeframe(b,c),"undefined"!=typeof d&&this.setCategoryID(d),this.loadConfig(a)}AnalyticsDashboard.prototype.emptyPanelContainer=function(a){var b="analytics_panel_"+a,c=document.getElementById(b);if("object"!=typeof c)return!1;if(c.hasChildNodes())for(i=0;i<c.childNodes.length;i++)c.removeChild(c.childNodes[i]);return!0},AnalyticsDashboard.prototype.loadConfig=function(a){if("object"!=typeof a)throw"Invalid dashboard config";if("undefined"!=typeof a.dashboardID&&this.setDashboardID(a.dashboardID),"object"==typeof a.panels){var b,c=Object.getOwnPropertyNames(a.panels);this.resetPanels();for(var d=0;d<c.length;d++)b=c[d],this.addPanel(b,a.panels[b])}"undefined"!=typeof a.personal&&this.setPersonal(a.personal),"string"==typeof a.title&&this.setTitle(a.title)},AnalyticsDashboard.prototype.removeWidget=function(a){var b=this.getPanel();for(var c in this.getPanel()){var d="analytics_panel_"+c,e=document.getElementById(d);if("object"!=typeof e)return;var f=b[c].widgets;if(0!==f.length)for(var g=0;g<f.length;g++)if(f[g].getWidgetID()===a){var h=f[g].getElements("container");h instanceof HTMLElement&&e.removeChild(h),f.splice(g,1)}}},AnalyticsDashboard.prototype.setupSorting=function(){"undefined"!=typeof $.fn.sortable&&($(".analytics-panel-charts").sortable({handle:".title",update:this.sortUpdate.bind(this)}),$(".analytics-panel-charts").disableSelection(),$(".analytics-panel-metrics").sortable({handle:".body",update:this.sortUpdate.bind(this)}),$(".analytics-panel-metrics").disableSelection())},AnalyticsDashboard.prototype.sortUpdate=function(a,b){for(var c,d=$(a.target).sortable("toArray"),e={},f=0;f<d.length;f++)c=AnalyticsWidget.getIDFromAttribute(d[f]),c&&(e[c]=f+1);$.post(gdn.url("/settings/analytics/dashboardsort/"+this.getDashboardID()),{TransientKey:gdn.definition("TransientKey"),Widgets:e})},AnalyticsDashboard.prototype.writeDashboard=function(){for(var a in this.getPanel())this.emptyPanelContainer(a),this.writePanel(a);this.isPersonal()&&this.setupSorting()},AnalyticsDashboard.prototype.writePanel=function(a){var b=this.getPanel(a);if(b===!1)throw"Invalid panel: "+a;var c="analytics_panel_"+a,d=document.getElementById(c);if("object"!=typeof d)throw"Unable to find container: #"+c;if("undefined"==typeof b.widgets||!Array.isArray(b.widgets))throw"Panel does not contain a widget array.";for(var e=0;e<b.widgets.length;e++)b.widgets[e].render(),d.appendChild(b.widgets[e].getElements("container"))};
//# sourceMappingURL=analyticsdashboard.min.js.map