function KeenIOWidget(e,t,n,i,r){this.client=null,this.config=n||{},this.chartConfig=this.config.chart||{},this.query=[],"object"==typeof t&&t instanceof Date?this.rangeEnd=t:this.rangeEnd=new Date,"object"==typeof e&&e instanceof Date?this.rangeStart=e:(this.rangeStart=new Date,this.rangeStart.setMonth(t.getMonth()-1)),this.addQuery(this.config.query||{})}KeenIOWidget.prototype.addQuery=function(e){if(e instanceof Array)for(i in e)this.addQuery(e[i]);else if("object"==typeof e){var t,n={start:this.rangeStart.toISOString(),end:this.rangeEnd.toISOString()};if(this.query.length>0&&"undefined"!=typeof this.query[0]){var r=this.query[0],a=r.params||{};t=a.interval||null}else t=e.interval||null;var o=new Keen.Query(e.analisysType||null,{eventCollection:e.eventCollection||null,filters:e.filters||[],interval:t,timeframe:n});o.title=e.title||null,this.query.push(o)}},KeenIOWidget.prototype.getClient=function(){if(!this.client&&"function"==typeof Keen){var e=gdn.meta["keenio.projectID"]||!1,t=gdn.meta["keenio.readKey"]||!1;this.client=new Keen({projectId:e,readKey:t})}return this.client},KeenIOWidget.prototype.write=function(e){if("object"==typeof e){var t=this.getClient();if("object"==typeof t){var n=new Keen.Dataviz,i=[];for(c in this.query)i.push(this.query[c].title);n.el(e).library("c3").chartType(this.chartConfig.type||"").chartOptions(this.chartConfig.options||{}).prepare(),t.run(this.query,function(e,t){t instanceof Array||(t=[t]);var r=t[0].result,a=[];r.forEach(function(e,n){var r=[];t.forEach(function(e,t){r.push({category:i[t],result:e.result[n].value})}),a.push({timeframe:e.timeframe,value:r})}),n.parseRawData({result:a}).render()})}}};