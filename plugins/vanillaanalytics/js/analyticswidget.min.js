function AnalyticsWidget(t){var e=!1,i=[],n=null,r=null,o=[],a="",s="chart",d=null,u={end:new Date,start:new Date};this.addSupport=function(t){if("undefined"!==t)if(Array.isArray(t))for(var e=0;e<t.length;e++)this.addSupport(t[e]);else"string"==typeof t&&o.push(t)},this.createElements=function(){var t=this.getElements();null!==t&&t.container.parentNode.removeChild(t.container);var e={body:document.createElement("div"),bookmark:document.createElement("a"),container:document.createElement("div"),title:null};e.container.setAttribute("id","analytics_widget_"+d),e.container.setAttribute("class","analytics-widget analytics-widget-"+s),this.isBookmarked()?e.bookmark.setAttribute("class","Hijack Bookmark Bookmarked"):e.bookmark.setAttribute("class","Hijack Bookmark"),e.bookmark.setAttribute("href",gdn.url("/settings/analytics/bookmarkwidget/"+this.getWidgetID())),e.bookmark.innerHTML="Bookmark","metric"!==this.getType()&&(e.title=document.createElement("h4"),e.title.setAttribute("class","title"),e.title.innerHTML=this.getTitle(),e.title.appendChild(e.bookmark),e.container.appendChild(e.title)),e.body.setAttribute("class","body"),e.container.appendChild(e.body),n=e},this.getData=function(){return i},this.getElements=function(t){if("string"==typeof t){if("undefined"!=typeof n[t])return n[t];throw"Invalid widget child element specified"}return n},this.getHandler=function(){return r},this.getInterval=function(){return i.query.interval},this.getTitle=function(){return a},this.getTimeframe=function(){return u},this.getType=function(){return s},this.getWidgetID=function(){return d},this.isBookmarked=function(){return e},this.setBookmarked=function(t){"boolean"==typeof t&&(e=t)},this.setData=function(t){"object"==typeof t&&(i=t)},this.setFilter=function(t,e,n){if(n&&!this.supports(n))return!1;var r=i.query.filters=i.query.filters||[],o=void 0;for(var a in r)if(r[a].property_name===t){e||r.splice(a,1),o=r[a];break}return e?(void 0===o?r.push({operator:"eq",property_name:t,property_value:e}):o.property_value=e,void this.drillGroupBy(n)):(this.drillGroupBy(n,!0),!0)},this.drillGroupBy=function(t,e){if(void 0!==i.query&&i.query.groupBy){var n,r;e?(n=t.replace("01","02"),r=t):(n=t,r=t.replace("01","02")),i.query.groupBy=i.query.groupBy.replace(n,r)}},this.setHandler=function(t){"string"==typeof t&&"function"==typeof window[t]&&(r=window[t])},this.setInterval=function(t){return void 0!==i.query&&i.query.interval?(i.query.interval=t,!0):!1},this.setTitle=function(t){"string"==typeof t&&(a=t)},this.setType=function(t){"string"==typeof t&&(s=t)},this.setWidgetID=function(t){"string"==typeof t&&(d=t)},this.setTimeframe=function(t,e){if("object"!=typeof t||!(t instanceof Date))throw"Invalid start date";if("object"!=typeof e||!(e instanceof Date))throw"Invalid end date";if(t>=e)throw"Invalid date range. Start equals or surpasses end.";return u.start=t,u.end=e,u},this.supports=function(t){return-1!==o.indexOf(t)},this.loadConfig(t)}AnalyticsWidget.prototype.loadConfig=function(t){if("object"!=typeof t)throw"Invalid dashboard config";"undefined"!=typeof t.bookmarked&&this.setBookmarked(t.bookmarked),"undefined"!=typeof t.data&&this.setData(t.data),"undefined"!=typeof t.handler&&this.setHandler(t.handler),"undefined"!=typeof t.supports&&this.addSupport(t.supports),"undefined"!=typeof t.title&&this.setTitle(t.title),"undefined"!=typeof t.type&&this.setType(t.type),"undefined"!=typeof t.widgetID&&this.setWidgetID(t.widgetID),"undefined"!=typeof t.timeframe&&"object"==typeof t.timeframe.start&&"object"==typeof t.timeframe.end&&this.setTimeframe(t.timeframe.start,t.timeframe.end)},AnalyticsWidget.prototype.render=function(){null===this.getElements()&&this.createElements();var t=this.getHandler();if(null===t)throw"No data handler configured for widget";var e=this.getTimeframe(),i=new t(e.start,e.end,this.getData(),this.getType(),this.getTitle());i.writeContents(this.getElements("body"))};