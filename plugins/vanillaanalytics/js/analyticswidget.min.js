function AnalyticsWidget(a){var b=!1,c=[],d=null,e=null,f=[],g="",h="chart",i=null,j={end:new Date,start:new Date};this.addSupport=function(a){if("undefined"!==a)if(Array.isArray(a))for(var b=0;b<a.length;b++)this.addSupport(a[b]);else"string"==typeof a&&f.push(a)},this.createElements=function(a){if(a="undefined"==typeof a?!0:!!a){var b=this.getElements();null!==b&&b.container.parentNode.removeChild(oldElements.container)}var c={body:document.createElement("div"),header:document.createElement("div"),bookmark:document.createElement("a"),options:document.createElement("div"),container:document.createElement("li"),title:null};c.container.setAttribute("id","analytics_widget_"+i),c.container.setAttribute("class","analytics-widget analytics-widget-"+h),c.options.setAttribute("class","analytics-widget-options"),c.header.setAttribute("class","analytics-widget-header"),this.isBookmarked()?c.bookmark.setAttribute("class","Hijack bookmark bookmarked"):c.bookmark.setAttribute("class","Hijack bookmark"),c.bookmark.setAttribute("href",gdn.url("/settings/analytics/bookmarkwidget/"+this.getWidgetID())),c.bookmark.innerHTML="Bookmark","metric"!==this.getType()&&(c.title=document.createElement("h4"),c.title.setAttribute("class","title"),c.title.innerHTML=this.getTitle(),c.header.appendChild(c.title)),c.options.appendChild(c.bookmark),c.header.appendChild(c.options),c.container.appendChild(c.header),c.body.setAttribute("class","body"),c.container.appendChild(c.body),d=c},this.getData=function(){return c},this.getElements=function(a){if(null===d&&this.createElements(!1),"string"==typeof a){if("undefined"!=typeof d[a])return d[a];throw"Invalid widget child element specified"}return d},this.getHandler=function(){return e},this.getInterval=function(){return c.query.interval},this.getTitle=function(){return g},this.getTimeframe=function(){return j},this.getType=function(){return h},this.getWidgetID=function(){return i},this.isBookmarked=function(){return b},this.setBookmarked=function(a){"boolean"==typeof a&&(b=a)},this.setData=function(a){"object"==typeof a&&(c=a)},this.setFilter=function(a,b,d){if(d&&!this.supports(d))return!1;var e=c.query.filters=c.query.filters||[],f=void 0;for(var g in e)if(e[g].property_name===a){b||e.splice(g,1),f=e[g];break}return b?(void 0===f?e.push({operator:"eq",property_name:a,property_value:b}):f.property_value=b,void this.drillGroupBy(d)):(this.drillGroupBy(d,!0),!0)},this.drillGroupBy=function(a,b){if(void 0!==c.query&&c.query.groupBy){var d,e;b?(d=a.replace("01","02"),e=a):(d=a,e=a.replace("01","02"));var f=this.getHandler().getQueryParam("groupBy");this.getHandler().updateQueryParams({groupBy:f.replace(d,e)})}},this.setCallback=function(a){if(null!==e)return e.setCallback(a),this;throw"No handler present for callback"},this.setHandler=function(a){if("string"==typeof a&&"function"==typeof window[a]){var b=this.getData();e=new window[a]({chartConfig:b.chartConfig,query:b.query,range:this.getTimeframe(),title:this.getTitle(),type:this.getType(),height:"30"})}else{if("object"!=typeof a)throw"Invalid value for newHandler";e=a}},this.setInterval=function(a){return this.getHandler().setInterval(a),!0},this.setRange=function(a){return this.getHandler().setRange(a),!0},this.setTitle=function(a){"string"==typeof a&&(g=a)},this.setType=function(a){"string"==typeof a&&(h=a)},this.setWidgetID=function(a){"string"==typeof a&&(i=a)},this.setTimeframe=function(a,b){if("object"!=typeof a||!(a instanceof Date))throw"Invalid start date";if("object"!=typeof b||!(b instanceof Date))throw"Invalid end date";if(a>=b)throw"Invalid date range. Start equals or surpasses end.";return j.start=a,j.end=b,j},this.supports=function(a){return-1!==f.indexOf(a)},this.loadConfig(a)}AnalyticsWidget.getIDFromAttribute=function(a){var b=/analytics_widget_([a-z0-9\-]+)/i.exec(a);return Array.isArray(b)?b[1]:!1},AnalyticsWidget.prototype.loadConfig=function(a){if("object"!=typeof a)throw"Invalid dashboard config";"undefined"!=typeof a.bookmarked&&this.setBookmarked(a.bookmarked),"undefined"!=typeof a.data&&this.setData(a.data),"undefined"!=typeof a.supports&&this.addSupport(a.supports),"undefined"!=typeof a.title&&this.setTitle(a.title),"undefined"!=typeof a.type&&this.setType(a.type),"undefined"!=typeof a.widgetID&&this.setWidgetID(a.widgetID),"undefined"!=typeof a.timeframe&&"object"==typeof a.timeframe.start&&"object"==typeof a.timeframe.end&&this.setTimeframe(a.timeframe.start,a.timeframe.end),"undefined"!=typeof a.handler&&(this.setHandler(a.handler),"undefined"!=typeof a.callback&&a.callback&&this.setCallback(a.callback))},AnalyticsWidget.prototype.render=function(){var a=this.getHandler();if(null===a)throw"No data handler configured for widget";a.writeContents(this.getElements("body"))};
//# sourceMappingURL=analyticswidget.min.js.map