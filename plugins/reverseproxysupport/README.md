# Reverse Proxy Support

Allows a forum to appear to be served from a different domain.
Useful to setup vanilla as a subdirectory.

## Specification

Settings:
- Proxy URL: A scheme, host, port (optional), path (optional) combo.
All URL generated by the forum will be relative to this URL.
  - Scheme: Either `http://`(force http) or `https://`(force https) or `//`(won't force anything).
  - Host: Hostname or ip of the proxy.
  - Port (optional): Need to be specified if different than the defaults 80 and 443. 
  - Path (optional): Subdirectory from which the forum will be served.
- Redirect to proxy: Activate to 301 redirect the forum URLs to the proxy URL. Useful for SEO purpose.
Note that this will make it impossible to access the forum from it's real URL unless Excluded IPs is used.
- Excluded IPs: Prevent redirection to the proxy if the `X-Forwarded-For` header matches one of the listed IPs.

## Case scenario

Let's say that we have a domain `proxy.example.com` and we want our forum to be located under
`proxy.example.com/community` but the forum is hosted on `vanillaforum.example.com`.

We can setup a proxy that will will redirect all call from `proxy.example.com/community` to `vanillaforum.example.com`
but the problem here is that all URL in the page will be generated using `vanillaforum.example.com`.

This plugin addresses this issue!

### How to setup

*This example will be using nginx as our proxy*

Proxy setup:
```nginx
    server_name proxy.example.com;
    listen 80;

    # Make sure that we can handle big responses.
    # Provided as an example only. This might not be needed and the values might be bigger than needed.
    # Fixes "upstream sent too big header while reading response header from upstream" error.
    proxy_buffer_size   128k;
    proxy_buffers   4 256k;
    proxy_busy_buffers_size   256k;

    location ~* ^/community/(.*) {
        proxy_read_timeout 600s;

        # Make sure that we forward the user IP
        proxy_set_header X-Forwarded-For $remote_addr;
        # Set X-Proxy-For to allow both http and https
        proxy_set_header X-Proxy-For //proxy-vanilla.dev/community;
        # Redirect the whole request, path and query, to vanillaforum.example.com
        proxy_pass $scheme://vanillaforum.example.com/$1$is_args$args;
    }
```

Plugin setup:

- Proxy URL: //proxy.example.com/community (This will allow both http:// and https:// urls)

Test the configuration and voila!

Note: You will probably want to enable the redirects too.

## Gotchas

If you are using the Hub/Node plugins you might need to increase your proxy buffer sizes like we did in the example setup.
Otherwise you will get 500 errors when manually syncing your nodes.
